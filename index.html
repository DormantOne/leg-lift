<!DOCTYPE html>
<html>
<head>
  <title>Leg Lift Test</title>
  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <!-- Add Firestore -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>

  <!-- Updated Form -->
  <form id="testForm">
    <input type="date" id="testDate" name="testDate" required>
    <input type="text" id="roomNumber" name="roomNumber" placeholder="Room Number" required>

    <!-- Leg strength options for Left Leg -->
    <fieldset>
      <legend>Left Leg Strength</legend>
      <label>
        <input type="radio" name="leftLeg" value="3"> Raises against resistance and can sustain
      </label>
      <label>
        <input type="radio" name="leftLeg" value="2"> Can raise leg off bed but gives immediately with resistance
      </label>
      <label>
        <input type="radio" name="leftLeg" value="1"> Cannot get heel off bed but bends knee
      </label>
      <label>
        <input type="radio" name="leftLeg" value="0"> Cannot bend knee or get heel off bed
      </label>
    </fieldset>

    <!-- Leg strength options for Right Leg -->
    <fieldset>
      <legend>Right Leg Strength</legend>
      <label>
        <input type="radio" name="rightLeg" value="3"> Raises against resistance and can sustain
      </label>
      <label>
        <input type="radio" name="rightLeg" value="2"> Can raise leg off bed but gives immediately with resistance
      </label>
      <label>
        <input type="radio" name="rightLeg" value="1"> Cannot get heel off bed but bends knee
      </label>
      <label>
        <input type="radio" name="rightLeg" value="0"> Cannot bend knee or get heel off bed
      </label>
    </fieldset>

    <label for="outcome">Can walk next day</label>
    <input type="checkbox" id="outcome" name="outcome">
    
    <input type="submit" value="Submit">
  </form>

  <!-- Display Data -->
  <div id="dataDisplay">
    <h2>Stored Data</h2>
    <ul id="dataList"></ul>
  </div>

  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCCY8_z-0C0RCQUp9brvM0hFMd7VsrjSXo",
      authDomain: "leg-lift.firebaseapp.com",
      projectId: "leg-lift",
      storageBucket: "leg-lift.appspot.com",
      messagingSenderId: "973223228733",
      appId: "1:973223228733:web:be43c16653cac99fe90154",
      measurementId: "G-0YK2ZTNCVX"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Event listener for form submissions
    document.getElementById('testForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Capture form data
      const testDate = document.getElementById('testDate').value;
      const roomNumber = document.getElementById('roomNumber').value;
      const leftLegScore = document.querySelector('input[name="leftLeg"]:checked').value;
      const rightLegScore = document.querySelector('input[name="rightLeg"]:checked').value;
      const totalLegScore = parseInt(leftLegScore) + parseInt(rightLegScore);
      const outcome = document.getElementById('outcome').checked;

      // Submit to Firestore
      db.collection('tests').add({
        date: testDate,
        room: roomNumber,
        leftLegScore: parseInt(leftLegScore),
        rightLegScore: parseInt(rightLegScore),
        totalLegScore: totalLegScore,
        outcome: outcome
      })
      .then((docRef) => {
        console.log("Document written with ID: ", docRef.id);
      })
      .catch((error) => {
        console.error("Error adding document: ", error);
      });
    });

    // Function to display data
    function displayData(doc) {
      let li = document.createElement('li');
      li.textContent = `Date: ${doc.data().date}, Room: ${doc.data().room}, Left Leg Score: ${doc.data().leftLegScore}, Right Leg Score: ${doc.data().rightLegScore}, Total Score: ${doc.data().totalLegScore}, Outcome: ${doc.data().outcome}`;
      document.getElementById('dataList').appendChild(li);
    }

    // Fetch and display all data from Firestore
    db.collection('tests').get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {
        displayData(doc);
      });
    });
  </script>
</body>
</html>
